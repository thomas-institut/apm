{% extends "bootstrap4/base.twig" %}
{% import 'bootstrap4/macros.twig' as macros %}

{% block title %}Doc: {{doc.docInfo.title}}{% endblock %}

{% block extraJS %}
    <script type="application/javascript" src="{{baseurl}}/js/DocShowPage.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/ApmUtil.js"></script>

    <script>
      let chunkInfo = JSON.parse('{{chunkInfo|json_encode|raw}}')
      let works = JSON.parse('{{works|json_encode|raw}}')
      let urlGenerator = new ApmUrlGenerator('{{baseurl}}')
      let docId = parseInt({{ doc.docInfo.id }})
      let lastVersions = JSON.parse('{{lastVersions|json_encode|raw}}')
      let authorInfo = JSON.parse('{{authorInfo|json_encode|raw}}')
      let lastSaves = JSON.parse('{{lastSaves|json_encode|raw}}')
      let pages = JSON.parse('{{doc.pages|json_encode|raw}}')
      console.log('Pages:')
      console.log(pages)
      console.log('Chunk Info: ')
      console.log(chunkInfo)
      console.log('Last Version: ')
      console.log(lastVersions)
      console.log('Authors:')
      console.log(authorInfo)
      console.log('Works:')
      console.log(works)
      console.log('Last Saves:')
      console.log(lastSaves)


      let docShowPage = new DocShowPage(pages, chunkInfo, lastVersions, lastSaves, works, authorInfo, docId, urlGenerator)

      $(function () {

        $('#chunkinfo').html(docShowPage.genWorkInfoHtml())
        $('#pagetablediv').html(docShowPage.getPageTableHtml())
        $('#lastsaves').html(docShowPage.getLastSavesHtml())
        $('[data-toggle="popover"]').popover({trigger:  'hover', html: true})
        ApmUtil.disableHyperlinks('a.alwaysblack')


      })
    </script>
{% endblock %}

{% block content %}
<nav aria-label="breadcumb">
     <ol class="breadcrumb">
         <li class="breadcrumb-item"><a href="{{url_for('docs')}}">Documents</a></li>
        <li class="breadcrumb-item active">Document Details</li>
    </ol>
</nav>
<h1>{{doc.docInfo.title}}</h1>
    <p class="docinfo">{{macros.langName(doc.docInfo.lang)}} {{macros.docTypeName(doc.docInfo.doc_type)}}, 
        {{doc.numTranscribedPages}} of {{doc.numPages}} pages transcribed
{% if doc.numLines %}
        by
        {% spaceless %}
        {% for editor in doc.editors %}
            <a href="{{url_for('user.profile', {'username' : editor.username})}}" title="View profile">{{editor.fullname}}</a>{% if not loop.last %}, {% endif %}
        {% endfor %}
        {% endspaceless %}{% endif %}</p>
    <p class="docinfo">{{doc.docInfoHtml|raw}}</p>
    <h3 class="docinfo">Pages</h3>
<div id="pagetablediv">
</div>

    <h3 class="docinfo">Works</h3>
    <div class="worksinfo" id="chunkinfo"></div>
    <h3 class="docinfo">Last Saves </h3>
    <div id="lastsaves"></div>
    
{% if canDefinePages %}
    <h3>Admin</h3>
    <ul>
        <li><a href="{{url_for('doc.editdoc', {'id' : doc.docInfo.id})}}">Edit / Delete document</a></li>
        <li><a href="{{url_for('doc.definedocpages', {'id' : doc.docInfo.id})}}">Add / Define pages</a></li>
    </ul>
{% endif %}    
{% endblock %}


