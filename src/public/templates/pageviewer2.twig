{% import 'macros.twig' as macros %}

<!DOCTYPE html>
<html>
<head>
    <title>Averroes Page Viewer</title>
    <link rel="stylesheet" type="text/css" media="screen" href="https://fonts.googleapis.com/css?family=PT+Sans"/>
    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/node_modules/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/node_modules/@shagstrom/split-pane/split-pane.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/css/styles.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/css/pageviewer.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/css/editor2.css" />
    
    <script type="application/javascript" src="{{baseurl}}/node_modules/lodash/lodash.js"></script>
    <script type="application/javascript" src="{{baseurl}}/node_modules/jquery/dist/jquery.js"></script>
    <script type="application/javascript" src="{{baseurl}}/node_modules/bootstrap/dist/js/bootstrap.js"></script>
    <script type="application/javascript" src="{{baseurl}}/node_modules/openseadragon/build/openseadragon/openseadragon.min.js"></script>
    <script type="application/javascript" src="{{baseurl}}/node_modules/@shagstrom/split-pane/split-pane.js"></script>
    <script type="text/javascript" src="{{baseurl}}/node_modules//twig/twig.js"></script>
    
    <script type="application/javascript" src="{{baseurl}}/node_modules/quill/dist/quill.min.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/ApiUrl.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/Item.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/Element.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/TranscriptionEditor2.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/TranscriptionEditorBlots.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/TranscriptionEditorBlotConfig.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/EditorClipboard.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/EditorData2.js"></script>
    <script type="application/javascript" src="{{baseurl}}/js/pageviewer2.js"></script>
    <link href='{{baseurl}}/images/averroes-icon.png' rel='icon' sizes='16x16' type='image/png'>
    <script>
        pageNumber = {{ page }}
        seq = {{ seq }}
        pageNumberFoliation = '{{ pageNumberFoliation }}'
        pageSystemId = {{pageInfo.id}}
        docId = {{ doc }}
        apiBase = '{{ baseurl }}'
        userId = {{userinfo.id}}
        defaultLang = '{{pageInfo.lang}}'
        foliation = '{{pageInfo.foliation}}'
        pageType = {{pageInfo.type}}
        pageTypeNames = JSON.parse('{{pageTypeNames|json_encode|raw}}')
        
        TranscriptionEditor.init('/public')
    </script>
</head>
<body>
<div id="viewerheader">
    <table width="100%">
        <tr>
            <td width="40%">
                <a href="{{path_for('home')}}" title="Back to main page"><img src="{{baseurl}}/images/averroes-logo-250.png"></a>
                <span class="textonly" style="margin-left: 30px"><a href="{{path_for('doc.showdoc', {'id' : doc })}}">{{ docInfo.title}}</a></span>
            </td>
            <td><ul class="pv-navbar"> 
                    <li style="float: left;">
                        {% if navByPage==true %}
                            <button class="textonly headerbutton {{ page==1?' disabled':''}}"
                                title="First Page" 
                                    onclick="window.location='{{path_for('pageviewer.docpage', {'doc': doc, 'page': 1})}}';" {{ page==1 ? ' disabled' : '' }}>
                        {% else %}
                            <button class="textonly headerbutton {{ seq==1?' disabled':''}}"
                                    onclick="window.location='{{path_for('pageviewer.docseq', {'doc': doc, 'seq': 1})}}';" {{ seq==1 ? ' disabled' : '' }}>
                        {% endif %}
                            <span class="glyphicon glyphicon-step-backward"></span>
                        </button>
                    </li>
                    <li style="float: left;">
                        {% if navByPage==true %}
                        <button class="textonly headerbutton {{ page==1?' disabled':''}}" 
                                title="Previous Page" 
                                onclick="window.location='{{path_for('pageviewer.docpage', {'doc': doc, 'page': page-1})}}';" {{ page==1 ? ' disabled' : '' }}>
                        {% else %}
                            <button class="textonly headerbutton {{ seq==1?' disabled':''}}" 
                                title="Previous Page" 
                                onclick="window.location='{{path_for('pageviewer.docseq', {'doc': doc, 'seq': seq-1})}}';" {{ seq==1 ? ' disabled' : '' }}>
                        {% endif %}
                            <span class="glyphicon glyphicon-chevron-left"></span>
                        </button>
                    </li>
                    <li style="float:left">
                        <button class="textonly headerbutton" id="pagenumber">
                            Page {{pageNumberFoliation}}
                        </button>
                    </li>
                    <li style="float: left;">
                        {% if navByPage==true %}
                        <button class="textonly headerbutton {{ page==docPageCount?' disabled':''}}"
                                title="Next Page" 
                                onclick="window.location='{{path_for('pageviewer.docpage', {'doc': doc, 'page': page+1})}}';" {{ page==docPageCount ? ' disabled' : '' }}>
                        {% else %}
                            <button class="textonly headerbutton {{ seq==docPageCount?' disabled':''}}"
                                title="Next Page" 
                                onclick="window.location='{{path_for('pageviewer.docseq', {'doc': doc, 'seq': seq+1})}}';" {{ seq==docPageCount ? ' disabled' : '' }}>
                        {% endif %}    
                            <span class="glyphicon glyphicon-chevron-right"></span>
                        </button>
                    </li>
                    <li style="float: left;">
                        {% if navByPage==true %}
                            <button class="textonly headerbutton {{ page==docPageCount?' disabled':''}}" 
                                title="Last Page" 
                                onclick="window.location='{{path_for('pageviewer.docpage', {'doc': doc, 'page': docPageCount})}}';" {{ page==docPageCount?' disabled':''}}>
                        {% else %}  
                            <button class="textonly headerbutton {{ seq==docPageCount?' disabled':''}}" 
                                title="Last Page" 
                                onclick="window.location='{{path_for('pageviewer.docseq', {'doc': doc, 'seq': docPageCount})}}';" {{ seq==docPageCount?' disabled':''}}>
                        {% endif %}
                            <span class="glyphicon glyphicon-step-forward"></span>
                        </button>
                    </li>

                </ul></td>
          
            <td><ul class="pv-navbar"> 
                    <li style="float: right;">
                        <button title="Exit Viewer" class="textonly headerbutton"
                                onclick="window.location='{{path_for('home')}}';">
                            <span class="glyphicon glyphicon-off"></span>
                        </button>
                    </li>
                </ul></td>
        </tr>
    </table>
</div> <!-- viewerheader -->
<!-- Page table popover -->
<script>
    $('#pagenumber').popover({title:'Page List', content: '{{macros.pageviewtablepv(doc, thePages, navByPage)|escape('js')}}', container: 'body', html: true, placement: 'auto', trigger: 'click'});
</script>
<div id="container">
<div class="split-pane vertical-percent">
    <div class="split-pane-component" id="left-component">
            </div>
            
            <script type="text/javascript">
                var viewer = OpenSeadragon({
                    id: "left-component",
                    prefixUrl: "{{baseurl}}/node_modules/openseadragon/build/openseadragon/images/",
                    maxZoomPixelRatio: 3,
                    tileSources: {
                        type: 'image',
                        url:  '{{imageUrl}}',
                        buildPyramid: false, 
                        homeFillsViewer: true
                    }
                });
            </script>
    <div class="split-pane-divider" id="divider"></div>
    <div class="split-pane-component" id="right-component">
        <ul class="nav nav-tabs" id="tabsUl">
            <li id="pageinfoHeader"><a data-toggle="tab" href="#pageinfoTab">
                    Page Info</a></li>
        </ul>
        <div class="tab-content" id="theTabs">
            <div class="textcol tab-pane pageinfo" id="pageinfoTab">
                <div style="margin-top: 20px">
                <p><strong>System Page Id:</strong> {{pageInfo.id}}</p>
                <p><strong>Page Number:</strong> {{pageInfo.page_number}}</p>
                <p><strong>Sequence Number:</strong> {{pageInfo.seq}}</p>
                <p><strong>Image Number:</strong> {{pageInfo.img_number}}</p>
                <p style="margin-top: 50px"/>
                <p><strong>Page Type:</strong> {{attribute(pageTypeNames, pageInfo.type).descr}}</p>
                <p><strong>Foliation:</strong> {% if pageInfo.foliation %}{{pageInfo.foliation}}{% else %}Undefined{% endif%}</p>
                <p><strong>Default Language:</strong> {{pageInfo.lang}}</p>
                <p><button type="button" id="editPageButton" class="btn btn-primary btn-sm">Edit Settings</button></p>
                <p style="margin-top: 50px"/>
                <p><strong>Num Columns:</strong> {{pageInfo.num_cols}}</p>
                <p><button type="button" id="addColumnButton" data-toggle="modal" 
                         data-target="#addColumnModal"
                         class="btn btn-primary btn-sm">Add Column</button></p>
                </div>
            </div>
            
        </div>
    </div>
</div>
</div>
                      
<!-- Add column modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="addColumnModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title text-info">Add Column</h4>
      </div>
      <div class="modal-body text-danger">
          <p>Are you sure you want to add a new column to this page?</p>
          <p class="text-warning">It cannot be undone!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="realAddColumnButton">Go for it!</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Page Settings Modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="editPageModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title text-info">Page Settings</h4>
      </div>
        <div class="modal-body">
            <form id="pageSettingsForm">
                <div id="editPage-type-fg" class="form-group">
                    <label for="editPage-type" class="control-label">Page Type:</label>
                    <select name="type" id="editPage-type"></select>
                </div>
                <div id="editPage-foliation-fg" class="form-group">
                    <label for="editPage-foliation" class="control-label">Foliation:</label>
                    <input name="foliation" type="text" class="form-control" id="editPage-foliation">
                    </input>
                </div>
                <div id="editPage-lang-fg" class="form-group">
                    <label for="editPage-lang" class="control-label">Default Language:</label>
                    <select name="lang" id="editPage-lang"></select>
                </div>
            </form>   
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="editPageSubmitButton">Go for it!</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</body>
</html>        