{#<!doctype html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="utf-8">#}
{#    <meta http-equiv="X-UA-Compatible" content="IE=edge">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">#}

{#    <link rel="stylesheet" type="text/css" href="{{baseurl}}/node_modules/bootstrap/dist/css/bootstrap.css"/>#}
{#    <link rel="stylesheet" type="text/css" href="{{baseurl}}/css/styles.css"/>#}
{#    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/css/collationtable.css" />#}
{#    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/css/collation.edit.css" />#}

{#    <link href='{{baseurl}}/images/apm-logo-square-32x32.png' rel='icon' sizes='32x32' type='image/png'>#}

{#    <title></title>#}

{#    <script type="text/javascript" src="{{baseurl}}/node_modules/jquery/dist/jquery.js"></script>#}
{#    <script type="text/javascript" src="{{baseurl}}/node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>#}
{#    <script type="text/javascript" src="{{baseurl}}/node_modules/moment/moment.js"></script>#}
{#    <script type="application/javascript" src="{{baseurl}}/js/ApmUrlGenerator.js"></script>#}
{#    <script type="text/javascript" src="{{baseurl}}/js/SimpleProfiler.js"></script>#}
{#    <script type="text/javascript" src="{{baseurl}}/node_modules/twig/twig.min.js"></script>#}
{#    <script type="application/javascript" src="{{baseurl}}/js/dist/CollationTableEditor.bundle.js"></script>#}
{#</head>#}
{#<body>#}
{#<nav class="navbar navbar-expand-lg navbar-light bg-white bottom-border-light py-0">#}
{#    <div class="container">#}
{#        <a class="navbar-brand" style="padding:0;" href="{{ url_for('home') }}"><img src="{{baseurl}}/images/apm-logo-plain.svg" height="50" ></a>#}
{#        <div id="navbar" class="collapse navbar-collapse">#}
{#            <ul class="navbar-nav mr-auto">#}
{#                <li class="nav-item"><a class="nav-link" href="{{url_for('dashboard')}}" title="Dashboard">Dashboard</a></li>#}
{#                <li class="nav-item"><a class="nav-link" href="{{url_for('docs')}}" title="Documents">Documents</a></li>#}
{#                <li class="nav-item"><a class="nav-link" href="{{url_for('works')}}" title="Works">Works</a></li>#}

{#                <li class="nav-item dropdown">#}
{#                    <a href="/" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Project Info</a>#}
{#                    <ul class="dropdown-menu">#}
{#                        <li><a class="nav-link" href="https://thomas-institut.github.io/averroes-workflow-guidelines/">Worflow Guidelines &nbsp;<i class="fas fa-external-link-alt"></i></a></li>#}
{#                        <li><a class="nav-link" href="https://thomas-institut.github.io/averroes-tei/averroes-guidelines.html">TEI Guidelines &nbsp;<i class="fas fa-external-link-alt"></i></a></li>#}
{#                        <li><a class="nav-link" href="https://wiki.uni-koeln.de/averroes_project/">Wiki &nbsp;<i class="fas fa-external-link-alt"></i></a></li>#}
{#                        <li><a class="nav-link" href="http://averroes.uni-koeln.de/legacy/">Legacy Files (e.g., old XML) &nbsp;<i class="fas fa-external-link-alt"></i></a></li>#}
{#                        <li><a class="nav-link" href="http://averroes.uni-koeln.de/">Public Website &nbsp;<i class="fas fa-external-link-alt"></i></a></li>#}
{#                    </ul>#}
{#                </li>#}
{#            </ul>#}

{#            <ul class="navbar-nav">#}
{#                <li class="nav-item dropdown">#}
{#                    <a class="nav-link dropdown-toggle" href="#"  data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">#}
{#                        <i class="fas fa-user"></i>&nbsp;{{ userinfo.name }}</a>#}
{#                    <ul class="dropdown-menu">#}
{#                        <li><a class="nav-link" href="{{ url_for('user.profile', {'username' : userinfo.userName}) }}">My Profile</a></li>#}
{#                        <li><a class="nav-link" href="{{ url_for('user.settings', {'username' : userinfo.userName}) }}">My Settings</a></li>#}
{#                        <li role="separator" class="divider"></li>#}
{#                        <li><a class="nav-link" href="{{ url_for('logout') }}" title="Logout">Logout</a></li>#}
{#                    </ul>#}
{#                </li>#}
{#            </ul>#}
{#        </div>#}
{#    </div>#}
{#</nav>#}
{#</div>#}

{#<div class="container">#}
{#    <div class="row">#}
{#        <div class="col-md-8">#}
{#            <div id="collationtabletitle">#}
{#                <h1><span id="cttitletext"></span></h1>#}
{#            </div>#}
{#            <div id="collationtableinfo"></div>#}
{#            <div id="collationtableactions"></div>#}
{#        </div>#}
{#        <div class="col-md-4 text-right" id="save-area">#}
{#            <h1><button class="btn btn-primary btn-sm hidden" id="savebutton">Save Changes</button></h1>#}
{#            <p><small>Last Save: <span id="lastSave">...</span></small></p>#}
{#            <div class="hidden" id="save-msg"></div>#}
{#        </div>#}
{#    </div>#}

{#    <div id="status" class="text-danger"></div>#}


{#    <ul class="nav nav-tabs" role="tablist" id="tabsUl">#}
{#        <li id="collationTableTabHeader" role="presentation" class="nav-item">#}
{#            <a role="tab" class="nav-link active" data-toggle="tab" href="#collationtablepanel">Collation Table</a>#}
{#        </li>#}
{#        <li id="editionTabHeader" class="nav-item" role="presentation">#}
{#            <a role="tab" class="nav-link" data-toggle="tab" id="edition-tab-title" href="#editiondiv-panel">Quick Edition</a>#}
{#        </li>#}
{#        <li id="witnessesTabHeader" class="nav-item" role="presentation">#}
{#            <a role="tab" class="nav-link" data-toggle="tab" href="#witnessesdiv">Witness Info</a>#}
{#        </li>#}
{#        <li id="versionHistoryTabHeader"  class="nav-item" role="presentation">#}
{#            <a role="tab" class="nav-link" data-toggle="tab" href="#admindiv">Admin</a>#}
{#        </li>#}
{#    </ul>#}

{#    <div class="tab-content">#}
{#        <div role="tabpanel" class="tab-pane active panetab nomargin-panel" id="collationtablepanel">#}
{#            <div class="ct-toolbar">#}
{#                <div class="ct-toolbar-section">#}
{#                    <div class="ct-toolbar-group" id="mode-toggle">#}
{#                    </div>#}
{#                    <div class="ct-toolbar-group">#}
{#                        <span id="popovers-toggle"></span>#}
{#                    </div>#}
{#                    <div class="ct-toolbar-group">#}
{#                        <span id="normalizations-toggle"></span>#}
{#                        &nbsp;#}
{#                        <a class="tb-button" href="#" title="Click to choose which normalizations to apply" id="normalizations-settings-button"><i class="fas fa-pen"></i></a>#}
{#                    </div>#}

{#                </div>#}
{#                <div>#}
{#                    <a id="export-csv-button" class="tb-button"  download="apm-collationtable.csv"#}
{#                       title="Download CSV"><small>CSV</small><i class="fas fa-download"></i></a>#}
{#                </div>#}

{#            </div>#}
{#            <div id="collationtablediv"><div class="loading">Loading table...  <i class="fas fa-circle-notch fa-spin"></i></div></div>#}
{#        </div>#}
{#        <div role="tabpanel" class="tab-pane panetab nomargin-panel" id="editiondiv-panel">#}
{#            <div class="ct-toolbar">#}
{#                <div>#}
{#                </div>#}
{#                <div>#}
{#                    <a id="export-svg-button" class="tb-button"  download="apm-quick-edition.svg"#}
{#                       title="Download SVG"><small>SVG</small> <i class="fas fa-download"></i></a>#}
{#                </div>#}
{#            </div>#}
{#            <div id="edition-svg-div">#}

{#            </div>#}
{#            <div id="edition-engine-info-div"></div>#}
{#        </div>#}
{#        <div role="tabpanel" class="tab-pane panetab" id="witnessesdiv">#}
{#            <div class="witnessinfotable"></div>#}
{#            <div class="witness-update-div">#}
{#                <span class="witness-update-info"></span>#}
{#                <button class="btn  btn-outline-secondary btn-sm check-witness-update-btn"  title="Click to check for updates to witness transcriptions">Check Now</button>#}
{#            </div>#}
{#            <div id="convert-to-edition-div">#}
{#                <button id="convert-to-edition-btn" class="btn btn-primary" title="Click to add a main text">Add Main Text</button>#}
{#            </div>#}
{#        </div>#}
{#        <div role="tabpanel" class="tab-pane panetab" id="admindiv">#}
{#            <div id="adminopsdiv">#}
{#                <h3>Admin</h3>#}
{#                <ul>#}
{#                    <li><button id="archive-table-btn" class="btn btn-danger" title="Click to archive this table/edition">Archive This Table</button></li>#}
{#                </ul>#}
{#            </div>#}
{#            <h3>Versions</h3>#}
{#            <div id="versionhistorydiv"></div>#}

{#        </div>#}
{#    </div>#}
{#</div>#}
{#<script>#}

{% extends "normal-page.twig" %}

{% block extraCSS %}
    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/css/collationtable.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="{{baseurl}}/css/collation.edit.css" />
{% endblock %}

{% block extraJS %}
    <script type="application/javascript" src="{{baseurl}}/js/dist/CollationTableEditor.bundle.js"></script>
{% endblock %}

{% block finalBodyJS %}
<script>
  $(() => {
    let ctData  = JSON.parse("{{collationTableData|json_encode|e('js')}}")
    let peopleInfo = JSON.parse("{{peopleInfo|json_encode|e('js')}}")
    let workInfo = JSON.parse("{{workInfo|json_encode|e('js')}}")
    let docInfo = JSON.parse("{{docInfo|json_encode|e('js')}}")
    let versionInfo = JSON.parse("{{versionInfo|json_encode|e('js')}}")

    new CollationTableEditor({
      commonData: JSON.parse("{{commonData|json_encode|e('js')}}"),
      collationTableData : ctData,
      workId: '{{ workId }}',
      chunkNumber: {{ chunkNumber }},
      tableId: {{ tableId }},
      peopleInfo: peopleInfo,
      workInfo: workInfo,
      docInfo: docInfo,
      versionInfo: versionInfo
    })
  })
  </script>
{% endblock %}
{#</script>#}
{#</body>#}
{#</html>#}